<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CALC PH</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        html {
            scroll-behavior: smooth;
        }
        body, table, th, td, input, button {
            font-family: Arial, sans-serif;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tfoot {
            background-color: #f9f9f9;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .number {
            text-align: right;
        }
        input[type="text"], input[type="number"], input[type="file"], input[type="date"], button {
            border-radius: 10px;
            padding: 5px;
            border: 1px solid #ccc;
            width: calc(100% - 22px);
            box-sizing: border-box;
            margin-bottom: 5px;
        }
        button {
            background-color: #486CB4;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 10px;
            padding: 10px 20px;
            margin-right: 5px;
        }
        button:hover {
            background-color: #696969;
        }
        #calcPH {
            display: none;
        }
        .valor-mono, .valor-color {
            background-color: #f2f2f2;
        }
        .align-right {
            text-align: right;
        }
        .commands {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            border-radius: 10px;
        }
        .container-cli {
            display: flex;
            flex-wrap: wrap;
            border-radius: 10px;
            background-color: Ivory; /* Cor tabela de Clientes */
        }
        .container-imp {
            display: flex;
            flex-wrap: wrap;
            border-radius: 10px;
            background-color: PowderBlue; /* Cor tabela de valores Impressão */
        }
        .container-cop {
            display: flex;
            flex-wrap: wrap;
            border-radius: 10px;
            background-color: LightCyan; /* Cor tabela de valores Cópia */
        }
        .container-dig {
            display: flex;
            flex-wrap: wrap;
            border-radius: 10px;
            background-color: PowderBlue; /* Cor tabela de valores Digitalização */
        }
        .column {
            flex: 1;
            min-width: 200px;
            padding: 5px 10px;
            border-radius: 10px;
	    margin-left: 10px; /* Adicione esta linha */
	    margin-right: 10px; /* Adicione esta linha */
	    margin-top: 10px; /* Adicione esta linha */
	    margin-bottom: 10px; /* Adicione esta linha */
        }
        .column-br {
            flex: 1;
            min-width: 200px;
            padding: 5px 10px;
            border-radius: 10px;
            background-color: LightGreen; /* Cor tabela idioma português */
	    margin-right: 10px; /* Adicione esta linha */
        }
        .column-es {
            flex: 1;
            min-width: 200px;
            padding: 5px 10px;
            border-radius: 10px;
            background-color: Khaki; /* Cor tabela idioma espanhol */
	    margin-left: 10px; /* Adicione esta linha */
        }
        .container label {
            width: 100%;
            display: inline-block;
        }
        .container input[type="file"] {
            width: 100%;
        }
        .compact-table th, .compact-table td {
            border: none;
            padding: 4px;
            text-align: left;
        }
        .loading-message {
            color: red;
            font-style: italic;
        }
        .calculo-container {
            display: flex;
            flex-wrap: wrap;
        }
        .calculo-column {
            flex: 1;
            min-width: 200px;
            padding: 10px;
        }
        .calculo-column label {
            display: block;
        }
        .fixed-header {
            position: fixed;
            top: 0;
            width: 98%;
            height: 70px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 4px 4px rgba(1,0,0,0.1);
            z-index: 1000;
        }
        .fixed-header img {
            height: 40px;
        }
        .fixed-header h1 {
            color: #486CB4;
            font-size: 20px;
            margin-right: 20px;
        }
        .fixed-header h2 {
            color: #486CB4;
            font-size: 16px;
            margin-right: 20px;
        }
        h2 {
            color: #486CB4;
            font-size: 16px;
            margin-right: 20px;
            text-align: center;
        }

        /* Estilo para limitar a área de impressão à sessão CALC PH */
        @media print {
            body * {
                visibility: hidden;
            }
            #calcPH, #calcPH * {
                visibility: visible;
            }
            #calcPH {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>
<body>

<div class="fixed-header">
    <h1>
        PRINT AUDIT CALC PH
    </h1>
    <h1>v1.0.20240804(beta)</h1>
</div>

<div style="height: 85px;"></div>

<section id="section1"></section>
<br>
<br>
<br>
<br>
<br>
<div class="container">
    <div class="column">
	<div class="column-br">
	        <img src="http://printaudit.la/images/icon_brazil_flag_portal.png"> <b>Como utilizar</b>
        	<br><br>
	</div>
	<br>
	<br>

        1) Dentro do PRINTANISTA HUB vá até a sessão Relatórios > Medidores > Relatório de Medidores (segunda opção no menu), escolha o modelo "CALC PH CPT";<br>
        2) Selecione o Cliente;<br>
        3) Exporte o modelo "CALC PH CPT" no formato ponto-e-vírgula (semicolon separated), sem qualificador de texto (aspas simples ou duplas);<br>
        4) Dentro do CALC PH preencha os dados do Cliente;<br>
        5) Na sessão "CARGA CSV", selecione o arquivo CSV para importação e exibição dos dados;<br>
        6) O cálculo é automático e os resultados preencherão um relatório para impressão na sessão CALC PH;<br>
        7) Na sessão "CONTROL" é possível resetar toda a página, é possível atualizar/recalcular alguma informação que necessite ser corrigida, e por fim visualizar/imprimir o relatório de cobrança processado.
	<br>
        <br>
        <b>Segurança e Privacidade</b><br>
        - Todo o processamento é feito em tela única visando simplicidade e rapidez;<br>
        - Não há transmissão ou armazenamendo de nenhum tipo de informação;<br>
        - O código é aberto e comentado, e pode ser verificado, auditado e testado diretamente em qualquer navegador do mercado;<br>
        - Para maiores detalhes ou retirada de dúvidas consulte <a href="mailto:suporte@printaudit.la?subject=Gostaria de Suporte sobre o CALC PH&body=Olá,%0D%0A%0D%0AGostaria de ajuda com o CALC PH.%0D%0A%0D%0AAtenciosamente,%0D%0A[nome do usuário]">suporte@printaudit.la</a>
        </b>
    </div>
	
    <div class="column">
	<div class="column-es">
        	<img src="http://printaudit.la/images/icon_spain_flag_portal.png"> <b>Cómo utilizar</b>
	        <br><br>
	</div>
	<br>
	<br>

        1) Dentro de PRINTANISTA HUB, vaya a la sección Informes > Medidores > Informe de Medidor (segunda opción en el menú), elija el modelo "CALC PH CPT";<br>
        2) Seleccionar el Cliente;<br>
        3) Exportar el modelo "CALC PH CPT" en formato punto y coma (separados por punto y coma), sin calificador de texto (comillas simples o dobles);<br>
        4) Dentro de CALC PH completar los datos del Cliente;<br>
        5) En la sección "CSV LOAD", seleccione el archivo CSV para importar y mostrar los datos;<br>
        6) El cálculo es automático y los resultados llenarán un informe para imprimir en la sesión CALC PH;<br>
        7) En la sesión "CONTROL" es posible restablecer toda la página, es posible actualizar/recalcular cualquier información que deba corregirse y finalmente ver/imprimir el informe de facturación procesado.
	<br>
        <br>
        <b>Seguridad y Privacidad</b><br>
        - Todo el procesamiento se realiza en una sola pantalla para mayor simplicidad y rapidez;<br>
        - No hay transmisión ni almacenamiento de ningún tipo de información;<br>
        - El código es abierto y comentado, y puede ser verificado, auditado y probado directamente en cualquier navegador del mercado;<br>
        - Para más detalles o dudas, por favor consultar <a href="mailto:soporte@printaudit.la?subject=Solicitud de soporte CALC PH&body=Hola,%0D%0A%0D%0AMe gustaría ayuda con CALC PH.%0D%0A%0D%0ASaludos,%0D%0A[nombre del usuário]">soporte@printaudit.la</a>
        </b>
    </div>
</div>

<br>
<br>

<section id="section2"></section>
<br>
<br>
<br>
<br>
<br>
<b><font color="#486CB4">CLIENTE</font></b>
<hr color="#F5333F">

<div class="container">
    <div class="column-br">
        <img src="http://printaudit.la/images/icon_brazil_flag_portal.png"> Insira os dados de seu cliente a serem exibidos no relatório de cobrança.<br><br>
    </div>
    <div class="column-es">
        <img src="http://printaudit.la/images/icon_spain_flag_portal.png"> Ingrese los datos de su cliente para que se muestren en el informe de facturación.<br><br>
    </div>
</div>
<br>

<div class="container-cli">
    <div class="column">
        <label for="DistName">Distribuidor</label>
        <input type="text" id="DistName" name="DistName" placeholder="<nome distribuidor>" value="<nome distribuidor>">
        <br>
        <br>
        <label for="clientName">Cliente</label>
        <input type="text" id="clientName" name="clientName" placeholder="<nome cliente>" value="<nome cliente>">
        <br>
        <br>
        <label for="clientAddress">Endereço/Dirección</label>
        <input type="text" id="clientAddress" name="clientAddress" placeholder="<endereço_dirección>" value="<endereço/dirección>">
        <br>
        <br>
        <label for="contactName">Contato/Contacto</label>
        <input type="text" id="contactName" name="contactName" placeholder="<nome contato/nombre contacto>" value="<nome contato/nombre contacto>">
        <br>
        <br>
        <label for="contactAddress">Email</label>
        <input type="text" id="contactAddress" name="contactAddress" placeholder="<email@email.com>" value="<email@email.com>">
        <br>
        <br>
        <label for="clientPhone">Telefone/Teléfono</label>
        <input type="text" id="clientPhone" name="clientPhone" placeholder="<telefone>" value="<telefone>">
    </div>
    <div class="column">
        <label for="idFiscalDist">ID Fiscal Distribuidor</label>
        <input type="text" id="idFiscalDist" name="idFiscalDist" placeholder="<id fiscal distribuidor>" value="<id fiscal /cnpj / rut>">
        <br>
        <br>
        <label for="idFiscalClient">ID Fiscal Cliente</label>
        <input type="text" id="idFiscalClient" name="idFiscalClient" placeholder="<id fiscal cliente>" value="<id fiscal / cnpj / rut>">
        <br>
        <br>
        <label for="clientNumber">Número Factura/Invoice</label>
        <input type="text" id="clientNumber" name="clientNumber" placeholder="<numero/factura/invoice>" value="<número factura/invoice>">
        <br>
        <br>
        <label for="date">Data/Fecha</label>
        <input type="text" id="date" name="date" placeholder="<dd/mm/aaaa>" value="<dd/mm/aaaa>">
        <br>
        <br>
        <label for="dueDate">Data/Fecha Venc.</label>
        <input type="text" id="dueDate" name="dueDate" placeholder="<dd/mm/aaaa>" value="<dd/mm/aaaa>">
        <br>
        <br>
        <label for="ref">Referência/Referencia</label>
        <input type="text" id="ref" name="ref" placeholder="<mm/aaaa>" value="<mm/aaaa>">
        <br>
        <br>
        <label for="notes">Notas/Termos</label>
        <input type="text" id="notes" name="notes" placeholder="<notas/termos>" value="<notas/termos>">
    </div>
</div>

<!-- Novo botão para carregar dados via CSV -->
<br>
<div class="container">
    <div class="column">
        <label for="clientLogo">Info Cliente <i>(CSV)</i></label>
        <input type="file" id="clientFileInput" accept=".csv">
        <p id="clientLoadingMessage" class="loading-message" style="display: none;">Carregando dados do cliente...</p>
        <p id="clientErrorMessage" class="error" style="display: none;">Erro ao carregar arquivo CSV. Verifique se o formato é ponto-e-vírgula (semicolon separated).</p>
        <br>
        <br>
        <label for="clientLogo">Logo Distribuidor/Cliente <i>(imag.)</i></label>
        <input type="file" id="clientLogo" name="clientLogo" accept="image/*">
        <img id="logoPreview" src="#" alt="Preview do Logo" style="display:none; width: 200px; height: 40px; margin-top: 5px;">
    </div>
</div>

<br>
<br>

<section id="section3"></section>
<br>
<br>
<br>
<br>
<br>
<b><font color="#486CB4">VALORES</font></b>
<hr color="#F5333F">

<div class="container">
    <div class="column-br">
    <img src="http://printaudit.la/images/icon_brazil_flag_portal.png"> Insira os valores cobrados para o cliente atualmente analisado.<br><br>
 </div>
    <div class="column-es">
        <img src="http://printaudit.la/images/icon_spain_flag_portal.png"> Ingrese los montos cobrados al cliente actualmente analizado.<br><br>
    </div>
</div>
<br>

<div class="container-imp">
    <div class="column">
        <label for="valorImpMonoA4">Valor Imp. Mono A4</label>
        <input type="number" id="valorImpMonoA4" step="0.001" value="0.06">
        <select id="tipoImpMonoA4">
            <option value="">Normal</option>
            <option value="0">Franquia</option>
            <option value="1">Cota</option>
        </select>
    <br>
    <br>
        <label for="valorImpColorA4">Valor Imp. Color A4</label>
        <input type="number" id="valorImpColorA4" step="0.001" value="0.12">
        <select id="tipoImpColorA4">
            <option value="">Normal</option>
            <option value="0">Franquia</option>
            <option value="1">Cota</option>
        </select>
    <br>
    <br>
        <label for="valorImpMonoA3">Valor Imp. Mono A3</label>
        <input type="number" id="valorImpMonoA3" step="0.001" value="0.15">
        <select id="tipoImpMonoA3">
            <option value="">Normal</option>
            <option value="0">Franquia</option>
            <option value="1">Cota</option>
        </select>
    <br>
    <br>
        <label for="valorImpColorA3">Valor Imp. Color A3</label>
        <input type="number" id="valorImpColorA3" step="0.001" value="0.35">
        <select id="tipoImpColorA3">
            <option value="">Normal</option>
            <option value="0">Franquia</option>
            <option value="1">Cota</option>
        </select>
    </div>

    <div class="column">
        <label for="qtdFranqCotaMensal_ImpMono_A4">Qtd Franq/Cota Mensal Imp. Mono A4</label>
        <input type="number" id="qtdFranqCotaMensal_ImpMono_A4" step="1" value="0">
    <br>
    <br>
    <br>
        <label for="qtdFranqCotaMensal_ImpColor_A4">Qtd Franq/Cota Mensal Imp. Color A4</label>
        <input type="number" id="qtdFranqCotaMensal_ImpColor_A4" step="1" value="0">
    <br>
    <br>
    <br>
        <label for="qtdFranqCotaMensal_ImpMono_A3">Qtd Franq/Cota Mensal Imp. Mono A3</label>
        <input type="number" id="qtdFranqCotaMensal_ImpMono_A3" step="1" value="0">
    <br>
    <br>
    <br>
        <label for="qtdFranqCotaMensal_ImpColor_A3">Qtd Franq/Cota Mensal Imp. Color A3</label>
        <input type="number" id="qtdFranqCotaMensal_ImpColor_A3" step="1" value="0">
   </div>

    <div class="column">
        <label for="valorAlemFranqCota_ImpMono_A4">Valor Além Franq/Cota Imp. Mono A4</label>
        <input type="number" id="valorAlemFranqCota_ImpMono_A4" step="0.001" value="0.06">
    <br>
    <br>
    <br>
        <label for="valorAlemFranqCota_ImpColor_A4">Valor Além Franq/Cota Imp. Color A4</label>
        <input type="number" id="valorAlemFranqCota_ImpColor_A4" step="0.001" value="0.12">
    <br>
    <br>
    <br>
        <label for="valorAlemFranqCota_ImpMono_A3">Valor Além Franq/Cota Imp. Mono A3</label>
        <input type="number" id="valorAlemFranqCota_ImpMono_A3" step="0.001" value="0.15">
    <br>
    <br>
    <br>
        <label for="valorAlemFranqCota_ImpColor_A3">Valor Além Franq/Cota Imp. Color A3</label>
        <input type="number" id="valorAlemFranqCota_ImpColor_A3" step="0.001" value="0.35">
    </div>
</div>


</div>

<div class="container-cop">
    <div class="column">
        <label for="valorCopiaMonoA4">Valor Cópia Mono A4</label>
        <input type="number" id="valorCopiaMonoA4" step="0.001" value="0.06">
        <select id="tipoCopiaMonoA4">
            <option value="">Normal</option>
            <option value="0" selected>Franquia</option>
            <option value="1">Cota</option>
        </select>
        <br>
        <br>
        <label for="valorCopiaColorA4">Valor Cópia Color A4</label>
        <input type="number" id="valorCopiaColorA4" step="0.001" value="0.24">
        <select id="tipoCopiaColorA4">
            <option value="">Normal</option>
            <option value="0">Franquia</option>
            <option value="1">Cota</option>
        </select>
    </div>

    <div class="column">
        <label for="qtdFranquiaMensal_CopMono_A4">Qtd Franq/Cota Mensal Cópia Mono A4</label>
        <input type="number" id="qtdFranquiaMensal_CopMono_A4" step="1" value="100">
        <br>
        <br>
        <br>
        <label for="qtdFranquiaMensal_CopColor_A4">Qtd Franq/Cota Mensal Cópia Color A4</label>
        <input type="number" id="qtdFranquiaMensal_CopColor_A4" step="1" value="0">
    </div>
    
    <div class="column">
        <label for="valorAlemFranquia_CopMono_A4">Valor Além Franq/Cota Cópia Mono A4</label>
        <input type="number" id="valorAlemFranquia_CopMono_A4" step="0.001" value="0.07">
        <br>
        <br>
        <br>
    <label for="valorAlemFranquia_CopColor_A4calcPH">Valor Além Franq/Cota Cópia Color A4</label>
        <input type="number" id="valorAlemFranquia_CopColor_A4calcPH" step="0.001" value="0.24">
    </div>
</div>

<div class="container-dig">
    <div class="column">
        <label for="valorScan">Valor Digitalização</label>
        <input type="number" id="valorScan" step="0.001" value="0.06">
        <select id="tipoScan">
            <option value="">Normal</option>
            <option value="0">Franquia</option>
            <option value="1" selected>Cota</option>
        </select>
    </div>

    <div class="column">
    <label for="qtdFranquiaMensalScan">Qtd. Franquia Mensal Digitalização</label>
        <input type="number" id="qtdFranquiaMensalScan" step="0" value="100">
    </div>

    <div class="column">
        <label for="valorAlemFranquiaScan">Valor Além Franq/Cota Digitalização</label>
        <input type="number" id="valorAlemFranquiaScan" step="0.001" value="0.07">
    </div>
</div>

<br>
<br>

<section id="section4"></section>
<br>
<br>
<br>
<br>
<br>
<b><font color="#486CB4">CARGA CSV</font></b>
<hr color="#F5333F">

<div class="container">
    <div class="column-br">
    <img src="http://printaudit.la/images/icon_brazil_flag_portal.png"> Carregue o arquivo CSV exportado a partir do Printanista HUB utilizando o modelo "CALC PH CPT". Colunas em verde representam resultados diferenciais por período e suas médias. Arquivo teste <a href="http://printaudit.la/calcph/CALC_PH_CPT.csv">Modelo Teste CSV</a><br><br>
 </div>
    <div class="column-es">
    <img src="http://printaudit.la/images/icon_spain_flag_portal.png"> Cargue el archivo CSV exportado desde Printanista HUB usando la plantilla "CALC PH CPT". Las columnas verdes representan resultados diferenciales por período y sus promedios. Archivo teste <a href="http://printaudit.la/calcph/CALC_PH_CPT.csv">Modelo Teste CSV</a><br><br>
    </div>
</div>
<br>

<input type="file" id="fileInput" accept=".csv">
<br>

<p id="loadingMessage" class="loading-message" style="display: none;">Aguarde o carregamento do arquivo CSV.</p>
<br>
<div id="tableContainer"></div>
<div id="errorMessage" class="error" style="display: none;">Erro ao carregar arquivo CSV. Verifique se o formato é ponto-e-vírgula (semicolon separated).</div>

<section id="section5"></section>
<br>
<br>
<br>
<br>
<br>
<b><font color="#486CB4">CALC PH</font></b>
<hr color="#F5333F">

<div id="calcPH">
    <img id="displayClientLogo" src="#" alt="Logo do Cliente" style="display:none; width: 200px; height: 40px; margin-bottom: 5px;">
    <br>
    <br>
    <div class="calculo-container">
        <div class="calculo-column">
            <label><b>Distribuidor:</b> <span id="displayDistName"></span></label>
            <label><b>ID Fiscal Distribuidor:</b> <span id="displayidFiscalDist"></span></label>
            <br>
            <label><b>Cliente:</b> <span id="displayClientName"></span></label>
            <label><b>ID Fiscal Cliente:</b> <span id="displayidFiscalClient"></span></label>
            <br>
            <label><b>Endereço/Dirección:</b> <span id="displayClientAddress"></span></label>
            <label><b>Contato/Contacto:</b> <span id="displayContactName"></span></label>
            <label><b>Email:</b> <span id="displayContactAddress"></span></label>
            <label><b>Telefone:</b> <span id="displayClientPhone"></span></label>
        </div>
        <div class="calculo-column">
            <label><b>Número:</b> <span id="displayClientNumber"></span></label>
            <br>
            <label><b>Data/Fecha:</b> <span id="displayDate"></span></label>
            <label><b>Data/Fecha Venc.:</b> <span id="displayDueDate"></span></label>
            <br>
            <label><b>Ref.:</b> <span id="displayRef"></span></label>
            <br>
            <label><b>Notas/Termos:</b> <span id="displayNotes"></span></label>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>DESCRIÇÃO/DESCRIPCIÓN</th>
                <th class="align-right">TIPO</th>
                <th class="align-right">QTD PROD</th>
                <th class="align-right">QTD FRANQ/COTA</th>
                <th class="align-right">VALOR A.FRANQ/COTA</th>
                <th class="align-right">VALOR UN</th>
                <th class="align-right">VALOR TOTAL</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Páginas Imp. Mono A4</td>
                <td id="tipoImpMonoA4Tabela" class="align-right"></td>
                <td id="qtdImpMonoA4" class="align-right"></td>
                <td id="qtdFranqImpMonoA4" class="align-right"></td>
                <td id="aFranqImpMonoA4" class="align-right"></td>
                <td id="valorUnImpMonoA4" class="align-right"></td>
                <td id="valorTotalImpMonoA4" class="align-right"></td>
            </tr>
            <tr>
                <td>Páginas Imp. Color A4</td>
                <td id="tipoImpColorA4Tabela" class="align-right"></td>
                <td id="qtdImpColorA4" class="align-right"></td>
                <td id="qtdFranqImpColorA4" class="align-right"></td>
                <td id="aFranqImpColorA4" class="align-right"></td>
                <td id="valorUnImpColorA4" class="align-right"></td>
                <td id="valorTotalImpColorA4" class="align-right"></td>
            </tr>
             <tr>
                <td>Páginas Imp. Mono A3</td>
                <td id="tipoImpMonoA3Tabela" class="align-right"></td>
                <td id="qtdImpMonoA3" class="align-right"></td>
                <td id="qtdFranqImpMonoA3" class="align-right"></td>
                <td id="aFranqImpMonoA3" class="align-right"></td>
                <td id="valorUnImpMonoA3" class="align-right"></td>
                <td id="valorTotalImpMonoA3" class="align-right"></td>
            </tr>
            <tr>
                <td>Páginas Imp. Color A3</td>
                <td id="tipoImpColorA3Tabela" class="align-right"></td>
                <td id="qtdImpColorA3" class="align-right"></td>
                <td id="qtdFranqImpColorA3" class="align-right"></td>
                <td id="aFranqImpColorA3" class="align-right"></td>
                <td id="valorUnImpColorA3" class="align-right"></td>
                <td id="valorTotalImpColorA3" class="align-right"></td>
            </tr>
            <tr>
                <td>Páginas Copiadas Mono A4</td>
                <td id="tipoCopiaMonoA4Tabela" class="align-right"></td>
                <td id="qtdCopiaMonoA4" class="align-right"></td>
                <td id="qtdFranqCopiaMonoA4" class="align-right"></td>
                <td id="aFranqCopiaMonoA4" class="align-right"></td>
                <td id="valorUnCopiaMonoA4" class="align-right"></td>
                <td id="valorTotalCopiaMonoA4" class="align-right"></td>
            </tr>
            <tr>
                <td>Páginas Copiadas Color A4</td>
                <td id="tipoCopiaColorA4Tabela" class="align-right"></td>
                <td id="qtdCopiaColorA4" class="align-right"></td>
                <td id="qtdFranqCopiaColorA4" class="align-right"></td>
                <td id="aFranqCopiaColorA4" class="align-right"></td>
                <td id="valorUnCopiaColorA4" class="align-right"></td>
                <td id="valorTotalCopiaColorA4" class="align-right"></td>
            </tr> 
            <tr>
                <td>Páginas Digitalizadas</td>
                <td id="tipoScanTabela" class="align-right"></td>
                <td id="qtdScan" class="align-right"></td>
                <td id="qtdFranqScan" class="align-right"></td>
                <td id="aFranqScan" class="align-right"></td>
                <td id="valorUnScan" class="align-right"></td>
                <td id="valorTotalScan" class="align-right"></td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td>TOTAL</td>
		<td></td>                
		<td id="totalRowCount" class="align-right"></td>
                <td></td>
                <td></td>
                <td></td>
                <td id="totalValorTotal" class="align-right"></td>
            </tr>
        </tfoot>
    </table>
</div>

<br>
<br>

<hr color="#F5333F">

<div class="commands">
    <button onclick="limparDados()">Reset</button>
    <button onclick="recalcular()">Actualizar / Recalcular</button>
    <button onclick="imprimir()">Ver / Imprimir</button>
</div>
<br>
<hr color="#F5333F">
<h2>
    <p>PRINT AUDIT CALC PH - VISITAS: <span id="contador">0</span></p>
</h2>
<br>

<script>
    document.getElementById('fileInput').addEventListener('change', handleFile, false);
    document.getElementById('clientLogo').addEventListener('change', handleLogo, false);
    document.getElementById('clientFileInput').addEventListener('change', handleClientFile, false);

    let loadedData = null;
    let formData = {};
    let logoData = null;
    let tableData = null;

    function handleFile(event) {
        document.getElementById('loadingMessage').style.display = 'block';
        const file = event.target.files[0];
        const reader = new FileReader();

        reader.onload = function(event) {
            if (file.type === "text/csv") {
                const csvData = event.target.result;
                if (csvData.includes(";")) {
                    loadedData = CSVToArray(csvData, ";");
                    document.getElementById('errorMessage').textContent = "";
                } else {
                    document.getElementById('errorMessage').textContent = "Por favor, carregue um arquivo CSV separado por ponto-e-vírgula.";
                    document.getElementById('loadingMessage').style.display = 'none';
                    return;
                }
            } else {
                const arrayBuffer = event.target.result;
                const workbook = XLSX.read(new Uint8Array(arrayBuffer), { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                loadedData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                document.getElementById('errorMessage').textContent = "";
            }

            generateTable(loadedData);
            fillCalculationSection(loadedData);
            setColumnBackgrounds();
            roundColumnValues();
            alignColumnsRight();
            document.getElementById('loadingMessage').style.display = 'none';
        };

        if (file.type === "text/csv") {
            reader.readAsText(file);
        } else {
            reader.readAsArrayBuffer(file);
        }
    }

    function handleClientFile(event) {
        document.getElementById('clientLoadingMessage').style.display = 'block';
        const file = event.target.files[0];
        const reader = new FileReader();

        reader.onload = function(event) {
            const csvData = event.target.result;
            if (csvData.includes(";")) {
                const clientData = CSVToArray(csvData, ";");
                document.getElementById('clientErrorMessage').style.display = 'none';
                fillClientData(clientData);
            } else {
                document.getElementById('clientErrorMessage').textContent = "Por favor, carregue um arquivo CSV separado por ponto-e-vírgula.";
                document.getElementById('clientErrorMessage').style.display = 'block';
            }
            document.getElementById('clientLoadingMessage').style.display = 'none';
        };

        reader.readAsText(file);
    }

    function fillClientData(data) {
        if (data.length > 1) {
            const clientData = data[1];
            document.getElementById('DistName').value = clientData[0] || "";
            document.getElementById('clientName').value = clientData[1] || "";
            document.getElementById('clientAddress').value = clientData[2] || "";
            document.getElementById('contactName').value = clientData[3] || "";
            document.getElementById('contactAddress').value = clientData[4] || "";
            document.getElementById('clientPhone').value = clientData[5] || "";
            document.getElementById('idFiscalDist').value = clientData[6] || "";
            document.getElementById('idFiscalClient').value = clientData[7] || "";
            document.getElementById('clientNumber').value = clientData[8] || "";
            document.getElementById('date').value = clientData[9] || "";
            document.getElementById('dueDate').value = clientData[10] || "";
            document.getElementById('ref').value = clientData[11] || "";
            document.getElementById('notes').value = clientData[12] || "";
        }
    }

    function handleLogo(event) {
        const file = event.target.files[0];
        const reader = new FileReader();

        reader.onload = function(event) {
            logoData = event.target.result;
            document.getElementById('logoPreview').src = logoData;
            document.getElementById('logoPreview').style.display = 'block';
            document.getElementById('displayClientLogo').src = logoData; // Adicionando essa linha para exibir a logo na sessão "CALC PH"
            document.getElementById('displayClientLogo').style.display = 'block';
        };

        reader.readAsDataURL(file);
    }

    function generateTable(data) {
        const container = document.getElementById('tableContainer');
        container.innerHTML = ''; // Clear any existing table

        const table = document.createElement('table');
        const headerRow = document.createElement('tr');

        data[0].forEach(header => {
            const th = document.createElement('th');
            th.textContent = header;
            headerRow.appendChild(th);
        });

        table.appendChild(headerRow);

        for (let i = 1; i < data.length; i++) {
            const row = document.createElement('tr');
            data[i].forEach(cell => {
                const td = document.createElement('td');
                td.textContent = cell;
                row.appendChild(td);
            });
            table.appendChild(row);
        }

        container.appendChild(table);
        tableData = data; // Save the table data
    }

    function CSVToArray(strData, strDelimiter) {
        strDelimiter = strDelimiter || ",";

        const objPattern = new RegExp(
            (
                "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +
                "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
                "([^\"\\" + strDelimiter + "\\r\\n]*))"
            ),
            "gi"
        );

        const arrData = [[]];
        let arrMatches = null;

        while (arrMatches = objPattern.exec(strData)) {
            const strMatchedDelimiter = arrMatches[1];
            if (
                strMatchedDelimiter.length &&
                strMatchedDelimiter !== strDelimiter
            ) {
                arrData.push([]);
            }

            const strMatchedValue = arrMatches[2]
                ? arrMatches[2].replace(new RegExp("\"\"", "g"), "\"")
                : arrMatches[3];

            arrData[arrData.length - 1].push(strMatchedValue);
        }

        return arrData;
    }

    function fillCalculationSection(data) {
        const DistName = document.getElementById('DistName').value;
        const clientName = document.getElementById('clientName').value;
        const contactName = document.getElementById('contactName').value;
        const contactAddress = document.getElementById('contactAddress').value;
        const clientAddress = document.getElementById('clientAddress').value;
        const clientPhone = document.getElementById('clientPhone').value;
        const idFiscalDist = document.getElementById('idFiscalDist').value;
        const idFiscalClient = document.getElementById('idFiscalClient').value;
        const clientNumber = document.getElementById('clientNumber').value;
        const date = document.getElementById('date').value;
        const dueDate = document.getElementById('dueDate').value;
        const ref = document.getElementById('ref').value;
        const notes = document.getElementById('notes').value;

        document.getElementById('displayDistName').textContent = DistName;
        document.getElementById('displayClientName').textContent = clientName;
        document.getElementById('displayContactName').textContent = contactName;
        document.getElementById('displayContactAddress').textContent = contactAddress;
        document.getElementById('displayClientAddress').textContent = clientAddress;
        document.getElementById('displayClientPhone').textContent = clientPhone;
        document.getElementById('displayidFiscalDist').textContent = idFiscalDist;
        document.getElementById('displayidFiscalClient').textContent = idFiscalClient;
        document.getElementById('displayClientNumber').textContent = clientNumber;
        document.getElementById('displayDate').textContent = date;
        document.getElementById('displayDueDate').textContent = dueDate;
        document.getElementById('displayRef').textContent = ref;
        document.getElementById('displayNotes').textContent = notes;

        const totalQtdImpMonoA4 = data.slice(1).reduce((sum, row) => sum + parseFloat(row[11] || 0), 0);
        const totalQtdImpColorA4 = data.slice(1).reduce((sum, row) => sum + parseFloat(row[15] || 0), 0);
        const totalQtdCopiaMonoA4 = data.slice(1).reduce((sum, row) => sum + parseFloat(row[19] || 0), 0);
        const totalQtdCopiaColorA4 = data.slice(1).reduce((sum, row) => sum + parseFloat(row[23] || 0), 0);
        const totalQtdImpMonoA3 = data.slice(1).reduce((sum, row) => sum + parseFloat(row[27] || 0), 0);
        const totalQtdImpColorA3 = data.slice(1).reduce((sum, row) => sum + parseFloat(row[31] || 0), 0);
        const totalQtdScan = data.slice(1).reduce((sum, row) => sum + parseFloat(row[35] || 0), 0);

        const valorUnImpMonoA4 = parseFloat(document.getElementById('valorImpMonoA4').value);
        const valorUnImpColorA4 = parseFloat(document.getElementById('valorImpColorA4').value);
        const valorUnCopiaMonoA4 = parseFloat(document.getElementById('valorCopiaMonoA4').value);
        const valorUnCopiaColorA4 = parseFloat(document.getElementById('valorCopiaColorA4').value);
        const valorUnImpMonoA3 = parseFloat(document.getElementById('valorImpMonoA3').value);
        const valorUnImpColorA3 = parseFloat(document.getElementById('valorImpColorA3').value);
        const valorUnScan = parseFloat(document.getElementById('valorScan').value);

        function calcularValorTotal(qtdProd, qtdFranqCota, tipo, valorUn, aFranqCota) {
            let valorTotal = 0;
            if (!tipo && qtdFranqCota === 0) {
                valorTotal = qtdProd * valorUn;
            } else if (tipo === "0" && qtdFranqCota > 0) {
                valorTotal = (qtdProd - qtdFranqCota) * aFranqCota;
            } else if (tipo === "1" && qtdFranqCota > 0) {
                valorTotal = ((qtdProd - qtdFranqCota) * aFranqCota) + (qtdProd * valorUn);
            }
            return valorTotal;
        }

        const totalValorTotalImpMonoA4 = calcularValorTotal(totalQtdImpMonoA4, parseFloat(document.getElementById('qtdFranqCotaMensal_ImpMono_A4').value), document.getElementById('tipoImpMonoA4').value, valorUnImpMonoA4, parseFloat(document.getElementById('valorAlemFranqCota_ImpMono_A4').value)).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const totalValorTotalImpColorA4 = calcularValorTotal(totalQtdImpColorA4, parseFloat(document.getElementById('qtdFranqCotaMensal_ImpColor_A4').value), document.getElementById('tipoImpColorA4').value, valorUnImpColorA4, parseFloat(document.getElementById('valorAlemFranqCota_ImpColor_A4').value)).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const totalValorTotalCopiaMonoA4 = calcularValorTotal(totalQtdCopiaMonoA4, parseFloat(document.getElementById('qtdFranquiaMensal_CopMono_A4').value), document.getElementById('tipoCopiaMonoA4').value, valorUnCopiaMonoA4, parseFloat(document.getElementById('valorAlemFranquia_CopMono_A4').value)).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const totalValorTotalCopiaColorA4 = calcularValorTotal(totalQtdCopiaColorA4, parseFloat(document.getElementById('qtdFranquiaMensal_CopColor_A4').value), document.getElementById('tipoCopiaColorA4').value, valorUnCopiaColorA4, parseFloat(document.getElementById('valorAlemFranquia_CopColor_A4calcPH').value)).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const totalValorTotalImpMonoA3 = calcularValorTotal(totalQtdImpMonoA3, parseFloat(document.getElementById('qtdFranqCotaMensal_ImpMono_A3').value), document.getElementById('tipoImpMonoA3').value, valorUnImpMonoA3, parseFloat(document.getElementById('valorAlemFranqCota_ImpMono_A3').value)).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const totalValorTotalImpColorA3 = calcularValorTotal(totalQtdImpColorA3, parseFloat(document.getElementById('qtdFranqCotaMensal_ImpColor_A3').value), document.getElementById('tipoImpColorA3').value, valorUnImpColorA3, parseFloat(document.getElementById('valorAlemFranqCota_ImpColor_A3').value)).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const totalValorTotalScan = calcularValorTotal(totalQtdScan, parseFloat(document.getElementById('qtdFranquiaMensalScan').value), document.getElementById('tipoScan').value, valorUnScan, parseFloat(document.getElementById('valorAlemFranquiaScan').value)).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        function formatNumber(value) {
            return parseFloat(value).toLocaleString('pt-BR');
        }

        document.getElementById('qtdImpMonoA4').textContent = formatNumber(totalQtdImpMonoA4);
        document.getElementById('tipoImpMonoA4Tabela').textContent = document.getElementById('tipoImpMonoA4').value === '0' ? 'Franquia' : document.getElementById('tipoImpMonoA4').value === '1' ? 'Cota' : '';
        document.getElementById('valorUnImpMonoA4').textContent = valorUnImpMonoA4.toFixed(3).replace(',', '.');
        document.getElementById('valorTotalImpMonoA4').textContent = totalValorTotalImpMonoA4;

        document.getElementById('qtdImpColorA4').textContent = formatNumber(totalQtdImpColorA4);
        document.getElementById('tipoImpColorA4Tabela').textContent = document.getElementById('tipoImpColorA4').value === '0' ? 'Franquia' : document.getElementById('tipoImpColorA4').value === '1' ? 'Cota' : '';
        document.getElementById('valorUnImpColorA4').textContent = valorUnImpColorA4.toFixed(3).replace(',', '.');
        document.getElementById('valorTotalImpColorA4').textContent = totalValorTotalImpColorA4;

        document.getElementById('qtdCopiaMonoA4').textContent = formatNumber(totalQtdCopiaMonoA4);
        document.getElementById('tipoCopiaMonoA4Tabela').textContent = document.getElementById('tipoCopiaMonoA4').value === '0' ? 'Franquia' : document.getElementById('tipoCopiaMonoA4').value === '1' ? 'Cota' : '';
        document.getElementById('valorUnCopiaMonoA4').textContent = valorUnCopiaMonoA4.toFixed(3).replace(',', '.');
        document.getElementById('valorTotalCopiaMonoA4').textContent = totalValorTotalCopiaMonoA4;

        document.getElementById('qtdCopiaColorA4').textContent = formatNumber(totalQtdCopiaColorA4);
        document.getElementById('tipoCopiaColorA4Tabela').textContent = document.getElementById('tipoCopiaColorA4').value === '0' ? 'Franquia' : document.getElementById('tipoCopiaColorA4').value === '1' ? 'Cota' : '';
        document.getElementById('valorUnCopiaColorA4').textContent = valorUnCopiaColorA4.toFixed(3).replace(',', '.');
        document.getElementById('valorTotalCopiaColorA4').textContent = totalValorTotalCopiaColorA4;

        document.getElementById('qtdImpMonoA3').textContent = formatNumber(totalQtdImpMonoA3);
        document.getElementById('tipoImpMonoA3Tabela').textContent = document.getElementById('tipoImpMonoA3').value === '0' ? 'Franquia' : document.getElementById('tipoImpMonoA3').value === '1' ? 'Cota' : '';
        document.getElementById('valorUnImpMonoA3').textContent = valorUnImpMonoA3.toFixed(3).replace(',', '.');
        document.getElementById('valorTotalImpMonoA3').textContent = totalValorTotalImpMonoA3;

        document.getElementById('qtdImpColorA3').textContent = formatNumber(totalQtdImpColorA3);
        document.getElementById('tipoImpColorA3Tabela').textContent = document.getElementById('tipoImpColorA3').value === '0' ? 'Franquia' : document.getElementById('tipoImpColorA3').value === '1' ? 'Cota' : '';
        document.getElementById('valorUnImpColorA3').textContent = valorUnImpColorA3.toFixed(3).replace(',', '.');
        document.getElementById('valorTotalImpColorA3').textContent = totalValorTotalImpColorA3;

        document.getElementById('qtdScan').textContent = formatNumber(totalQtdScan);
        document.getElementById('tipoScanTabela').textContent = document.getElementById('tipoScan').value === '0' ? 'Franquia' : document.getElementById('tipoScan').value === '1' ? 'Cota' : '';
        document.getElementById('valorUnScan').textContent = valorUnScan.toFixed(3).replace(',', '.');
        document.getElementById('valorTotalScan').textContent = totalValorTotalScan;

const totalGeral = (
    parseFloat(totalValorTotalImpMonoA4.replace(/\./g, '').replace(',', '.')) +
    parseFloat(totalValorTotalImpColorA4.replace(/\./g, '').replace(',', '.')) +
    parseFloat(totalValorTotalCopiaMonoA4.replace(/\./g, '').replace(',', '.')) +
    parseFloat(totalValorTotalCopiaColorA4.replace(/\./g, '').replace(',', '.')) +
    parseFloat(totalValorTotalImpMonoA3.replace(/\./g, '').replace(',', '.')) +
    parseFloat(totalValorTotalImpColorA3.replace(/\./g, '').replace(',', '.')) +
    parseFloat(totalValorTotalScan.replace(/\./g, '').replace(',', '.'))
).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });


        document.getElementById('totalValorTotal').textContent = totalGeral;

        document.getElementById('calcPH').style.display = 'block';

        formData = {
            DistName,
            clientName,
            contactName,
            contactAddress,
            clientAddress,
            clientPhone,
            idFiscalDist,
            idFiscalClient,
            clientNumber,
            date,
            dueDate,
            ref,
            notes
        };

        document.getElementById('qtdFranqImpMonoA4').textContent = parseFloat(document.getElementById('qtdFranqCotaMensal_ImpMono_A4').value).toLocaleString('pt-BR');
        document.getElementById('qtdFranqImpColorA4').textContent = parseFloat(document.getElementById('qtdFranqCotaMensal_ImpColor_A4').value).toLocaleString('pt-BR');
        document.getElementById('qtdFranqCopiaMonoA4').textContent = parseFloat(document.getElementById('qtdFranquiaMensal_CopMono_A4').value).toLocaleString('pt-BR');
        document.getElementById('qtdFranqCopiaColorA4').textContent = parseFloat(document.getElementById('qtdFranquiaMensal_CopColor_A4').value).toLocaleString('pt-BR');
        document.getElementById('qtdFranqImpMonoA3').textContent = parseFloat(document.getElementById('qtdFranqCotaMensal_ImpMono_A3').value).toLocaleString('pt-BR');
        document.getElementById('qtdFranqImpColorA3').textContent = parseFloat(document.getElementById('qtdFranqCotaMensal_ImpColor_A3').value).toLocaleString('pt-BR');
        document.getElementById('qtdFranqScan').textContent = parseFloat(document.getElementById('qtdFranquiaMensalScan').value).toLocaleString('pt-BR');

        document.getElementById('aFranqImpMonoA4').textContent = parseFloat(document.getElementById('valorAlemFranqCota_ImpMono_A4').value).toFixed(3).replace(',', '.');
        document.getElementById('aFranqImpColorA4').textContent = parseFloat(document.getElementById('valorAlemFranqCota_ImpColor_A4').value).toFixed(3).replace(',', '.');
        document.getElementById('aFranqImpMonoA3').textContent = parseFloat(document.getElementById('valorAlemFranqCota_ImpMono_A3').value).toFixed(3).replace(',', '.');
        document.getElementById('aFranqImpColorA3').textContent = parseFloat(document.getElementById('valorAlemFranqCota_ImpColor_A3').value).toFixed(3).replace(',', '.');
        document.getElementById('aFranqCopiaMonoA4').textContent = parseFloat(document.getElementById('valorAlemFranquia_CopMono_A4').value).toFixed(3).replace(',', '.');
        document.getElementById('aFranqCopiaColorA4').textContent = parseFloat(document.getElementById('valorAlemFranquia_CopColor_A4calcPH').value).toFixed(3).replace('.', '.');
        document.getElementById('aFranqScan').textContent = parseFloat(document.getElementById('valorAlemFranquiaScan').value).toFixed(3).replace(',', '.');

        // Calcula e exibe a soma de QTD PROD
        const totalQtdProd = totalQtdImpMonoA4 + totalQtdImpColorA4 + totalQtdCopiaMonoA4 + totalQtdCopiaColorA4 + totalQtdImpMonoA3 + totalQtdImpColorA3 + totalQtdScan;
        document.getElementById('totalRowCount').textContent = formatNumber(totalQtdProd);
    }

    function setColumnBackgrounds() {
        const table = document.querySelector('table');
        if (!table) return;

        const colIndexList = {
            11: "valor-mono",
            15: "valor-color",
            19: "valor-mono",
            23: "valor-color",
            27: "valor-mono",
            31: "valor-color",
            35: "valor-color"
        };

        for (const [colIndex, className] of Object.entries(colIndexList)) {
            const index = parseInt(colIndex, 10);
            table.querySelectorAll(`td:nth-child(${index + 1})`).forEach(cell => {
                cell.classList.add(className);
            });
        }
    }

    function roundColumnValues() {
        const table = document.querySelector('table');
        if (!table) return;

        table.querySelectorAll('td').forEach(cell => {
            const value = parseFloat(cell.textContent);
            if (!isNaN(value)) {
                cell.textContent = value.toFixed(0).replace(',', '.');
            }
        });
    }

    function alignColumnsRight() {
        const table = document.querySelector('table');
        if (!table) return;

        table.querySelectorAll('td').forEach(cell => {
            cell.style.textAlign = 'right';
        });
    }

    function limparDados() {
        document.getElementById('DistName').value = "";
        document.getElementById('clientName').value = "";
        document.getElementById('clientAddress').value = "";
        document.getElementById('contactName').value = "";
        document.getElementById('contactAddress').value = "";
        document.getElementById('clientPhone').value = "";
        document.getElementById('idFiscalDist').value = "";
        document.getElementById('idFiscalClient').value = "";
        document.getElementById('clientNumber').value = "";
        document.getElementById('date').value = "";
        document.getElementById('dueDate').value = "";
        document.getElementById('ref').value = "";
        document.getElementById('notes').value = "";
        document.getElementById('clientLogo').value = "";
        document.getElementById('logoPreview').style.display = 'none';
        document.getElementById('fileInput').value = "";
        document.getElementById('tableContainer').innerHTML = "";
        document.getElementById('calcPH').style.display = 'none';
    }

    function recalcular() {
        if (loadedData) {
            generateTable(loadedData);
            fillCalculationSection(loadedData);
            setColumnBackgrounds();
            roundColumnValues();
            alignColumnsRight();
        }
    }

    function imprimir() {
        window.print();
    }

    let contador = localStorage.getItem('contador') || 0;
    contador++;
    localStorage.setItem('contador', contador);
    document.getElementById('contador').textContent = contador;
</script>

</body>
</html>
